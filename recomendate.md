# Рекомендации по улучшению проекта

Этот документ содержит список рекомендаций по улучшению архитектуры и надежности арбитражного бота.

## 1. Интеграция реальной/бумажной торговли

Текущая реализация находит арбитражные возможности, но не совершает сделок. В коде присутствует `PaperTradeExecutor`, но он не используется в `main.py`.

**Задача:** Интегрировать `PaperTradeExecutor` в основной цикл `main.py` для симуляции торговых операций при обнаружении арбитражной возможности. Это станет основой для перехода к реальной торговле.

## 2. Повышение надежности WebSocket-клиентов

### 2.1. Обработка "зависших" соединений

**Проблема:** Если WebSocket-соединение с одной из бирж "зависнет" без разрыва, `PriceState` будет хранить устаревшую цену, что может привести к ложным арбитражным сигналам.

**Рекомендация:** Добавить в `PriceState` механизм TTL (Time-To-Live), который будет автоматически сбрасывать (или помечать как неактуальную) цену, если она не обновлялась дольше заданного интервала (например, 2-3 секунды).

### 2.2. Отказоустойчивость и переподключение

**Проблема:** В `main.py` падение одного WebSocket-клиента приведет к остановке всего приложения из-за `asyncio.gather`.

**Рекомендация:**
-   Реализовать в `BaseWSClient` логику автоматического переподключения с экспоненциальной задержкой (exponential backoff) в случае потери соединения.
-   В `main.py` обернуть запуск каждого клиента в отдельный `try...except`, чтобы падение одного клиента не останавливало работу остальных.

## 3. Улучшение качества кода

### 3.1. Использование Enum для названий бирж

**Проблема:** Использование строковых литералов ("bybit", "okx") для идентификации бирж может привести к опечаткам.

**Рекомендация:** Создать `Enum` для названий бирж, чтобы сделать код более безопасным и читаемым.

```python
# core/enums.py
from enum import Enum

class ExchangeName(Enum):
    BYBIT = "bybit"
    OKX = "okx"
```

### 3.2. Устранение дублирования кода

**Проблема:** В `main.py` логика поиска арбитража дублируется для разных пар бирж.

**Рекомендация:** Реорганизовать код, чтобы итерироваться по списку активных бирж и проверять все возможные комбинации в цикле. Это упростит добавление новых бирж в будущем.

Пример:
```python
from itertools import permutations

exchanges = ["bybit", "okx"] # В идеале использовать Enum

# ... в main.py
for buy_exchange, sell_exchange in permutations(exchanges, 2):
    opportunity = evaluator.evaluate(buy_exchange, sell_exchange)
    if opportunity:
        # ... обработка возможности
```

## 4. Управление балансами

**Проблема:** Текущая логика не учитывает доступные балансы на биржах. Арбитражная возможность бесполезна, если у вас нет нужных активов для совершения сделки (например, USDT для покупки BTC или BTC для продажи).

**Рекомендация:**
-   Добавить в проект модуль для отслеживания балансов на биржах.
-   Перед выполнением сделки (даже бумажной) проверять, достаточно ли средств на соответствующих счетах.
-   Регулярно (но не слишком часто, чтобы не быть забаненным) обновлять информацию о балансах.
